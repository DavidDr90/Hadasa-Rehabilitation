<ion-header>
  <ion-navbar>
    <ion-title *ngIf="!isCategory">הוספת ביטוי</ion-title>
    <ion-title *ngIf="isCategory">הוספת קטגוריה</ion-title>

    <!-- add the back arrow to the navBar, the arrow dose not add adomaticly becaese it's a 'modal' -->
    <ion-buttons left>
      <button ion-button icon-only (click)="cancel()" class="my-style-for-modal">
          <ion-icon name="arrow-back"></ion-icon>
      </button>
  </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content padding>
  <form [formGroup]="_myForm" >
    <!-- deal with the image choosing procces -->
    <!-- connect the file choose to the html elemnt -->
    <input type="file" #fileInput style="visibility: hidden; height: 0px" name="files[]" (change)="processWebImage($event)" />
    <div class="profile-image-wrapper" (click)="presentActionSheet()">
      <!-- display circle with '+' symbol for adding an image -->
      <div class="profile-image-placeholder" [hidden]="lastImage !== null">
        <ion-icon name="add"></ion-icon>
        <div>
          הוספת תמונה
        </div>
      </div>
      <!-- display the choosen image -->
      <img src="{{pathForImage(lastImage)}}" style="width: 100%" [hidden]="lastImage === null">
    </div>

    <!-- deal with the user input fileds -->
    <ion-item>
      <ion-label *ngIf="!isCategory">ביטוי</ion-label>
      <ion-label *ngIf="isCategory">קטגוריה</ion-label>

      <ion-input #textInput (click)="getCaretPos($event)" (keyup)="getCaretPos($event)" formControlName="text"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label>הצג מקלדת ניקוד</ion-label>
      <ion-checkbox checked="false" (click)="_needNikud = !_needNikud"></ion-checkbox>
    </ion-item>
    <!-- display the nikud buttons on demend -->
    <ion-grid *ngIf="_needNikud">
      <ion-row>
        <ion-col col-auto *ngFor="let nikud of getNikud">
          <button ion-button (click)="addNikudToText(nikud.uniCode)">
            {{ nikud.uniCode }}
          </button>
        </ion-col>
      </ion-row>
    </ion-grid>

    <button ion-button primary (touchstart)="startRecord()" (touchend)="stopRecord()">
      <ion-icon name="mic" *ngIf="!recording"></ion-icon>
      <ion-icon name="mic-off" *ngIf="recording"></ion-icon>
      &nbsp;&nbsp; {{ micText }}
    </button>

    <!-- TODO: ask eran about how to reactived the component -->
    <div [hidden]="!recording">
      <timer #myTimer></timer>
    </div>

    <button ion-button primary (click)="getAudioFromTTS()" *ngIf="!recording">
      <ion-icon name="radio"></ion-icon>&nbsp;&nbsp; יצר הקלטה</button>

    <ion-list>
      <ion-item *ngIf="fileName != null && !recording">
        <p>{{fileName}}</p>
        <button ion-button clear item-end large (click)="playAudio()" *ngIf="!playing">
          <ion-icon name="play"></ion-icon>
        </button>
        <button ion-button clear item-end large (click)="stopAudio()" *ngIf="playing">
          <ion-icon name="pause"></ion-icon>
        </button>
      </ion-item>
    </ion-list>

    <!-- show the object that create from the inputs -->
    <p>{{ _myForm.value | json }}</p>


    <button ion-button large full type="submit" [disabled]="!_myForm.valid" (click)="onSubmit()">
      <ion-icon name="home" large></ion-icon>
      אישור
    </button>

  </form>
</ion-content>